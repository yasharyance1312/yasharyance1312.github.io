<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mobility Impact Analyser (MIA) Tool</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.form.io/formiojs/formio.full.min.js"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script src="https://cdn.form.io/ace/ace.js"></script>

    <script src="https://cdn.form.io/formiojs/formio.full.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap");
      * {
        margin: 0px;
        padding: 0px;
      }

      .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        flex: 1; /* Take the full available space in the container */
      }

      .row-wrapper {
        max-width: 600px; /* Limit the width of the row */
        width: 100%;
      }

      .overall-impact-item {
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        width: 100%;
        min-height: 250px; /* Set a minimum height for cards */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      h1 {
        font-weight: normal; /* Reduce the heading font-weight */
        font-size: 1.5rem; /* Adjust the heading font-size */
        margin: 0; /* Remove default margin */
        margin-bottom: 20px; /* Add some spacing below the heading */
      }

      .overall-impact-item h2 {
        margin-top: 0;
        font-size: 1.2rem; /* Adjust the card heading font-size */
        font-weight: bold;
        color: #333;
      }

      .highlight {
        font-size: 1rem;
        font-weight: bold;
        color: #428bca; /* Adjust the highlight color */
      }

      .overall-results-icon {
        /* font-size: 3.5rem; Adjust icon size */
        color: #ff6f00; /* Orange color */
      }

      /* Simple animation on hover */
      .overall-impact-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* Set font and spacing */
      body {
        font-family: Arial, sans-serif;
        line-height: 1.5;

        font-family: "Roboto", sans-serif;
        /* background-color: #f1f1f1;
        padding: 20px; */
      }

      #formio {
        /* width: 700px !important; */
        /* margin: auto; */
        margin-top: 50px;
        float: left;
        width: 40%;
      }

      #results-div {
        /* margin: auto; */
        margin-top: 50px;
        float: left;
        width: 45%;
        margin-left: 50px;
      }

      #main-container {
        padding: 30px;
      }
      .sr-only {
        display: none;
      }

      .second-order-heading legend {
        font-size: inherit;
        margin-top: 12px;
      }

      /* Form container */
      form {
        max-width: 400px;
        margin: 0 auto;
      }

      /* Form fields */
      form input[type="text"],
      form input[type="email"],
      form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 10px;
      }

      /* Form labels */
      form label {
        font-weight: bold;
      }

      /* Submit button */
      form input[type="submit"] {
        background-color: #4285f4;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }

      form input[type="submit"]:hover {
        background-color: #3367d6;
      }

      /* Error messages */
      form .error {
        color: #ff0000;
        margin-top: 5px;
      }

      /* Success message */
      form .success {
        color: #008000;
        margin-top: 5px;
      }

      #derivation-div {
        background-color: #f1f1f1;
        color: #333;
        padding: 10px;
        font-family: monospace;
        white-space: pre-wrap;
        color: #ff6f00; /* Orange font color */
      }

      #codeHeading {
        font-family: "Arial", sans-serif;
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        color: #333;
        background-color: #f1f1f1;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* #construction-phase-results-div {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      } */

      .unit {
        padding-left: 5px;
      }

      .result-containers {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .title {
        font-size: 22px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

      .impact-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .icon {
        margin-right: 10px;
        font-size: 20px;
        color: #ff6f00; /* Orange color */
      }

      .impact-text {
        font-size: 16px;
        color: #333; /* Dark gray color */
        line-height: 1.4;
      }

      .unit {
        font-size: 12px;
        color: #777; /* Light gray color */
        padding-left: 5px;
      }

      .card-header {
        background-color: #ff6f00 !important; /* Orange font color */
      }

      .field-set-header legend {
        font-size: 17px;
        margin-top: 15px;
      }

      .header {
        background-color: #3498db; /* Update with your preferred background color */
        padding: 20px;
        color: #fff;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        font-size: 24px;
        font-weight: bold;
        margin: 0;
      }

      .logo-icon {
        margin-right: 5px;
      }

      .menu {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
      }

      .menu-item {
        margin-right: 20px;
      }

      .menu-link {
        color: #fff;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .menu-link:hover {
        color: #ffd700; /* Update with your preferred hover color */
      }
    </style>
  </head>
  <body>
    <div class="header">
      <nav class="nav">
        <h1 class="logo">
          <i class="fas fa-cogs logo-icon"></i>
              Mobility Impact Analyser (MIA) Tool
        </h1>
        <ul class="menu">
          <!-- <li class="menu-item"><a href="#" class="menu-link">Road</a></li>
        <li class="menu-item"><a href="#" class="menu-link">Metro</a></li>
        <li class="menu-item"><a href="#" class="menu-link">Contact</a></li> -->
        </ul>
      </nav>
    </div>

    <div id="main-container">
      <div id="errorContainer"></div>
      <div id="formio"></div>

      <div id="results-div">
        <div class="result-containers container mt-4" id="overall-results-div">
          <h1 class="text-center" id="overall-results-header">
            <!-- Overall Impacts from Road Transportation Having Flexible Pavement -->
          </h1>
          <div class="row-wrapper">
            <div class="row"></div>
          </div>
        </div>

        <div class="result-containers" id="use-phase-results-div">
          <div class="title">Use Phase Impact on the Environment</div>
        </div>

        <div class="result-containers" id="construction-phase-results-div">
          <div class="title">Construction Impact on the Environment</div>
        </div>

        <div class="result-containers" id="derivation-div">
          <div class="title">Derivation</div>
        </div>
      </div>

      <script type="text/javascript">
        const errorContainer = document.getElementById("errorContainer");
        console.log(errorContainer, "errorContainer");
        window.onerror = function (message, source, lineno, colno, error) {
          console.log("insideon error");
          // Create a new error message element
          const errorMessage = document.createElement("p");
          errorMessage.classList.add("error-message");
          errorMessage.textContent = `${message} at line ${lineno}, column ${colno}`;

          // Append the error message element to the error container
          errorContainer.appendChild(errorMessage);

          // Return false to prevent the default browser error handling
          return false;
        };

        window.onload = function () {
          document.getElementById("overall-results-div").style.display = "none";
          document.getElementById("use-phase-results-div").style.display =
            "none";
          document.getElementById(
            "construction-phase-results-div"
          ).style.display = "none";

          document.getElementById("derivation-div").style.display = "none";

          var roadPavement = "";
          var y1 = "";
          var y2 = "";
          var y3 = "";
          var y4 = "";
          var y5 = "";
          var y6 = "";
          var y7 = "";
          var y8 = "";
          var z = "";

          var i = "";
          var j = "";
          var k = "";
          var l = "";

          var dT = "";
          var a1 = "";
          var b1 = "";
          var c1 = "";
          var d1 = "";
          var e1 = "";
          var f1 = "";
          var g1 = "";
          var h1 = "";
          var x = "";

          var a2 = "";
          var b2 = "";
          var c2 = "";
          var d2 = "";
          var e2 = "";
          var f2 = "";
          var g2 = "";
          var h2 = "";

          var irCME_abiotic_depletion_fossil = [];

          var ifCME_abiotic_depletion_fossil = [];

          var irCME_acidification = [];

          var ifCME_acidification = [];

          var irCME_global_warming = [];

          var ifCME_global_warming = [];

          // loadUseCaseForm();
          // return;
          let url = "http://localhost:3001/mia";
          if (location.hostname == "yasharyance1312.github.io") {
            url = "https://yasharyance1312.github.io/mia.json";
          }

          Formio.createForm(document.getElementById("formio"), url, {
            hooks: {
              beforeSubmit: (submission, next) => {
                console.log("Before Submit.", submission);
                if (submission && submission.data) {
                  if (!checkMissingKeys(submission.data)) {
                    console.log("Missing Keys Value");
                    return;
                  } else {
                    clearDerivationContent();
                    startComputing(submission.data);
                  }
                }
              },
            },
          });
        };

        function loadUseCaseForm() {
          let url = "http://localhost:3001/usephase";
          if (location.hostname == "yasharyance1312.github.io") {
            url = "https://yasharyance1312.github.io/usephase.json";
          }

          Formio.createForm(document.getElementById("formio"), url, {
            hooks: {
              beforeSubmit: (submission, next) => {
                console.log("Before Submit.", submission);
                if (submission && submission.data) {
                  console.log(submission.data, "Before Method Call");
                  startUsePhaseComputation(submission.data);
                  console.log("After Method Call");
                }
              },
            },
          });
        }

        function startUsePhaseComputation(inputJson) {
          console.log("----------------------------------");
          console.log(inputJson, "computation started");

          let defaultPercentValues = 0;

          let m = inputJson.percentOfCNGBus || defaultPercentValues;
          let n = inputJson.percentOfDieselBus || defaultPercentValues;
          let o = inputJson.percentOfCNGCar || defaultPercentValues;
          let p = inputJson.percentOfDieselCar || defaultPercentValues;
          let q = inputJson.percentOfPetrolCar || defaultPercentValues;
          let r = inputJson.percentOfCNGTaxi || defaultPercentValues;
          let s = inputJson.percentOfDieselTaxi || defaultPercentValues;
          let t = inputJson.percentOfPetrolTaxi || defaultPercentValues;
          let u = inputJson.percentOfCNGAuto || defaultPercentValues;
          let v = inputJson.percentOfDieselAuto || defaultPercentValues;
          let w = inputJson.percentOfPetrolAuto || defaultPercentValues;

          logVariableDerivations({ m, n, o, p, q, r, s, t, u, v, w });

          // let i = 100; // ToDo: Will come from the data point
          // let j = 100; // ToDo: Will come from the data point
          // let k = 100; // ToDo: Will come from the data point
          // let l = 100; // ToDo: Will come from the data point
          // let dT = 100; // ToDo: Will come from the data point

          // Buses
          let nCB = calculatePercentageOfNumber(m, i);
          let nDB = calculatePercentageOfNumber(n, i);
          logVariableDerivations({ nCB, nDB });

          // cars
          let nCC = calculatePercentageOfNumber(o, j);
          let nDC = calculatePercentageOfNumber(p, j);
          let nPC = calculatePercentageOfNumber(q, j);
          logVariableDerivations({ nCC, nDC, nPC });

          // Taxi
          let nCT = calculatePercentageOfNumber(r, k);
          let nDT = calculatePercentageOfNumber(s, k);
          let nPT = calculatePercentageOfNumber(t, k);
          logVariableDerivations({ nCT, nDT, nPT });

          // Auto
          let nCA = calculatePercentageOfNumber(u, l);
          let nDA = calculatePercentageOfNumber(v, l);
          let nPA = calculatePercentageOfNumber(w, l);

          logVariableDerivations({ nCA, nDA, nPA });

          // Computing Diesel Required /////
          // CNG required for bus (Cb) = (Ncb × dT)/3.16
          // CNG required for car (Cc) = (Ncc × dT)/24.86
          // CNG required for taxi (Ct) = (Nct × dT)/22.56
          // CNG required for auto (Ca) = (Nca × dT)/31.7

          // CNG Required
          let Cb = computeFuelRequired(nCB, dT, 3.16);
          let Cc = computeFuelRequired(nCC, dT, 24.86);
          let Ct = computeFuelRequired(nCT, dT, 22.56);
          let Ca = computeFuelRequired(nCA, dT, 31.7);

          logVariableDerivations({ Cb, Cc, Ct, Ca });

          // Diesel required for bus (Db) = (Ndb × dT)/4.13
          // Diesel required for car (Dc) = (Ndc × dT)/15
          // Diesel required for taxi (Dt) = (Ndt × dT)/13
          // Diesel required for auto (Da) = (Nda × dT)/28
          // Diesel Required
          let Db = computeFuelRequired(nDB, dT, 4.13);
          let Dc = computeFuelRequired(nDC, dT, 15);
          let Dt = computeFuelRequired(nDT, dT, 13);
          let Da = computeFuelRequired(nDA, dT, 28);

          logVariableDerivations({ Db, Dc, Dt, Da });

          // Petrol required for car (Pc) = (Npc × dT)/10
          // Petrol required for taxi (Pt) = (Npt × dT)/9
          // Petrol required for auto (Pa) = (Npa × dT)/25/

          // Petrol Required
          let Pc = computeFuelRequired(nPC, dT, 10);
          let Pt = computeFuelRequired(nPT, dT, 9);
          let Pa = computeFuelRequired(nPA, dT, 25);

          logVariableDerivations({ Pc, Pt, Pa });

          let fC = Cb + Cc + Ct + Ca; // in Kg Total CNG required
          let fD = Db + Dc + Dt + Da; // in litres Total diesel required
          let fP = Pc + Pt + Pa; // in Kg Total petrol required

          logVariableDerivations({ fC, fD, fP });

          let usePhase = {
            cng: {
              abiotic_depletion_fossil: 55.9,
              acidification: 0.00112,
              global_warming: 0.743,
            },
            diesel: {
              abiotic_depletion_fossil: 42.3,
              acidification: 0.00234,
              global_warming: 0.436,
            },
            petrol: {
              abiotic_depletion_fossil: 38,
              acidification: 0.00393,
              global_warming: 0.497,
            },
          };

          let iFC_abiotic_depletion_fossil = [
            fC * usePhase["cng"]["abiotic_depletion_fossil"],
            fD * usePhase["diesel"]["abiotic_depletion_fossil"],
            fP * usePhase["petrol"]["abiotic_depletion_fossil"],
          ];

          let iFC_acidification = [
            fC * usePhase["cng"]["acidification"],
            fD * usePhase["diesel"]["acidification"],
            fP * usePhase["petrol"]["acidification"],
          ];

          let iFC_global_warming = [
            fC * usePhase["cng"]["global_warming"],
            fD * usePhase["diesel"]["global_warming"],
            fP * usePhase["petrol"]["global_warming"],
          ];

          logVariableDerivations({
            iFC_abiotic_depletion_fossil,
            iFC_acidification,
            iFC_global_warming,
          });

          iFC_abiotic_depletion_fossil = sumArrayValues(
            iFC_abiotic_depletion_fossil
          );
          iFC_global_warming = sumArrayValues(iFC_global_warming);
          iFC_acidification = sumArrayValues(iFC_acidification);

          logVariableDerivations({
            iFC_abiotic_depletion_fossil,
            iFC_acidification,
            iFC_global_warming,
          });

          let iTE = calculateCO2Emissions(
            nCB,
            nDB,
            nCC,
            nDC,
            nPC,
            nCT,
            nDT,
            nPT,
            nCA,
            nDA,
            nPA
          );

          let use_phase_results_data = [
            {
              impactText: `Total Use Phase Impacts on Abiotic Depletion Fossil`,
              icon: "fa-fire-alt",
              unit: ` ${removeDecimalPrecision(iFC_abiotic_depletion_fossil)} MJ/km/year`,
            },
            {
              impactText: `Total Use Phase Impacts on Acidification`,
              icon: "fa-cloud",
              unit: `${removeDecimalPrecision(iFC_acidification)} kg SO2 eq./km/year`,
            },
            {
              impactText: `Total Use Phase Impacts on Global Warming`,
              icon: "fa-globe",
              unit: ` ${removeDecimalPrecision(iFC_global_warming + iTE)} kg CO2 eq./km/year`,
            },
          ];

          generateAndDisplayResults(
            use_phase_results_data,
            "use-phase-results-div"
          );

          let iCME_abiotic_depletion_fossil = 0;
          let iCME_acidification = 0;
          let iCME_global_warming = 0;
          let results_title = "Overall Impacts from Road Transportation";

          if (roadPavement == "rigid") {
            iCME_abiotic_depletion_fossil = irCME_abiotic_depletion_fossil;
            iCME_acidification = irCME_acidification;
            iCME_global_warming = irCME_global_warming;
            results_title =
              "Overall Impacts from Road Transportation Having Rigid Pavement";
          } else {
            iCME_abiotic_depletion_fossil = ifCME_abiotic_depletion_fossil;
            iCME_acidification = ifCME_acidification;
            iCME_global_warming = ifCME_global_warming;
            results_title =
              "Overall Impacts from Road Transportation Having Flexible Pavement";
          }

          let overall_impact_data = [
            {
              icon: "bus",
              title: `Overall Impacts on Abiotic Depletion Fossil `,
              description: ` ${
                removeDecimalPrecision(iCME_abiotic_depletion_fossil + iFC_abiotic_depletion_fossil)
              } MJ/km/year`,
            },
            {
              icon: "cloud",
              title: `Overall Impacts on Acidification`,
              description: `${
                removeDecimalPrecision(iCME_acidification + iFC_acidification)
              } kg SO2 eq./km/year`,
            },
            {
              icon: "globe",
              title: `Overall Impacts on Global Warming`,
              description: ` ${
                removeDecimalPrecision(iCME_global_warming + iFC_global_warming + iTE)
              } kg CO2 eq./km/year`,
            },
          ];
          generateOverallResults(results_title, overall_impact_data);
        }

        function checkMissingKeys(inputJson) {
          console.log("---------------------------------- Check Missing");
          let array = [
            "distanceCoveredByAuto",
            "distanceCoveredByBus",
            "distanceCoveredByCar",
            "distanceCoveredByTaxi",
            // "lengthOfFootpath", // ToDo: Add check for conditional keys
            "noOfPassengersPerYear",
            "npOfLanes",
            "panelSelectRoadInfrastructures",
            "passengerTravellingFromAuto",
            "passengerTravellingFromBus",
            "passengerTravellingFromCar",
            "passengerTravellingFromTaxi",
            "roadPavement",
            "totalDistanceTravelledPerYear",
          ];

          const jsonKeys = Object.keys(inputJson);
          for (let i = 0; i < array.length; i++) {
            const key = array[i];

            if (!jsonKeys.includes(key)) {
              console.error(
                `Error: Key "${key}" is missing in the input JSON.`
              );

              throw new Error(
                `Error: Key "${key}" is missing in the input JSON.`
              );
              return false;
            }
          }

          return true;
        }

        function startComputing(inputJson) {
          roadPavement = inputJson.roadPavement;
          // Footpath
          y1 = inputJson.lengthOfFootpath || 0;

          // Slab Culvert
          y2 = inputJson.lengthOfSlabCulvert || 0; // lengthOfSlabCulvert
          y3 = inputJson.noOfSlabCulvert || 0; // noOfSlabCulvert

          // Pipe Culvert
          y4 = inputJson.diameterOfPipeCulvert || 0;
          y5 = inputJson.noOfPipeCulvert || 0;

          // Overhead Signage
          y6 = inputJson.noOfOverheadSignage || 0;

          //Flyover
          y7 = inputJson.lengthOfFlyover || 0;
          y8 = inputJson.noOfFlyover || 0;

          //No of Lanes
          z = inputJson.npOfLanes;

          // Total Distance Tobe Travelled in km per year
          dT = inputJson.totalDistanceTravelledPerYear;

          logVariableDerivations({ y1, y2, y3, y4, y5, y6, y7, y8, z, dT });
          // % of distance covered by vehicle
          a1 = inputJson.distanceCoveredByBus;
          b1 = inputJson.distanceCoveredByCar;
          c1 = inputJson.distanceCoveredByTaxi;
          d1 = inputJson.distanceCoveredByAuto;

          // Distance Travelled by Bus
          e1 = calculatePercentageOfNumberForDistance(a1, dT);

          // Distance Travelled by Car
          f1 = calculatePercentageOfNumberForDistance(b1, dT);

          // Distance Travelled by Taxi
          g1 = calculatePercentageOfNumberForDistance(c1, dT);

          // Distance Travelled by Auto
          h1 = calculatePercentageOfNumberForDistance(d1, dT);
          logVariableDerivations({ a1, b1, c1, d1, e1, f1, g1, h1 });
          console.log(
            `Distance Travelled By Bus: ${e1} Car: ${f1} Taxi: ${g1} Auto: ${h1}`
          );

          if (dT != e1 + f1 + g1 + h1) {
            console.log(
              `Total Distance in kms ${dT} & distance covered by vehicles (${
                e1 + f1 + g1 + h1
              }) are not matching up.`
            );
            throw new Error(
              `Total Distance in kms ${dT} & distance covered by vehicles (${
                e1 + f1 + g1 + h1
              }) are not matching up.`
            );
          }

          // No of passengers per year
          x = inputJson.noOfPassengersPerYear;

          // Travelling from Vehicles
          a2 = inputJson.passengerTravellingFromBus;
          b2 = inputJson.passengerTravellingFromCar;
          c2 = inputJson.passengerTravellingFromTaxi;
          d2 = inputJson.passengerTravellingFromAuto;
          // Passenger travelling by Bus
          e2 = calculatePercentageOfNumberForDistance(a2, x);

          // Passenger travelling by Car
          f2 = calculatePercentageOfNumberForDistance(b2, x);

          // Passenger travelling by Taxi
          g2 = calculatePercentageOfNumberForDistance(c2, x);

          // Passenger travelling by Auto
          h2 = calculatePercentageOfNumberForDistance(d2, x);
          logVariableDerivations({ a2, b2, c2, d2, e2, f2, g2, h2 });

          console.log(
            `Passenger Travelling By Bus: ${e2} Car: ${f2} Taxi: ${g2} Auto: ${h2}`
          );

          if (x != e2 + f2 + g2 + h2) {
            console.log();
            throw new Error(
              `Total Passengers Travelling Per Year ${x} & Passenger travelling by vehicles (${
                e2 + f2 + g2 + h2
              }) are not matching up.`
            );
          }

          // let passengesPerBus = 53;
          // let passengersPerCar = 2.5;
          // let passengersPerTaxi = 2;
          // let passengersPerAuto = 1.5;

          // No. of Vehicles required
          i = calculateVehiclesRequired(
            "buses",
            e1,
            e2,
            f1,
            f2,
            g1,
            g2,
            h1,
            h2
          );
          j = calculateVehiclesRequired("cars", e1, e2, f1, f2, g1, g2, h1, h2);
          k = calculateVehiclesRequired(
            "taxis",
            e1,
            e2,
            f1,
            f2,
            g1,
            g2,
            h1,
            h2
          );
          l = calculateVehiclesRequired(
            "autos",
            e1,
            e2,
            f1,
            f2,
            g1,
            g2,
            h1,
            h2
          );

          logVariableDerivations({ i, j, k, l });

          let vehicle_impact = {
            bus: {
              abiotic_depletion_fossil: 40800,
              acidification: 11,
              global_warming: 2400,
            },
            car: {
              abiotic_depletion_fossil: 2756,
              acidification: 0.83,
              global_warming: 149,
            },
            taxi: {
              abiotic_depletion_fossil: 3675,
              acidification: 1.11,
              global_warming: 198,
            },
            auto: {
              abiotic_depletion_fossil: 1657,
              acidification: 0.52,
              global_warming: 84,
            },
          };

          let infraImpact = {
            footpath: {
              abiotic_depletion_fossil: 10417,
              acidification: 5.077,
              global_warming: 3507,
            },

            slab_culvert: {
              abiotic_depletion_fossil: 11135,
              acidification: 3.73,
              global_warming: 2606,
            },

            pipe_culvert: {
              abiotic_depletion_fossil: 3.291,
              acidification: 0.0009925,
              global_warming: 0.68,
            },

            overhead_signage: {
              abiotic_depletion_fossil: 6947,
              acidification: 2.96,
              global_warming: 807,
            },

            flyover: {
              abiotic_depletion_fossil: 4365585,
              acidification: 1625,
              global_warming: 401919,
            },
          };

          let usePhase = {
            cng: {
              abiotic_depletion_fossil: 55.9,
              acidification: 0.00112,
              global_warming: 0.743,
            },
            diesel: {
              abiotic_depletion_fossil: 42.3,
              acidification: 0.00234,
              global_warming: 0.436,
            },
            petrol: {
              abiotic_depletion_fossil: 38,
              acidification: 0.00393,
              global_warming: 0.497,
            },
          };

          // ToDO: Check with Yasj, sheet got multiple values
          let rigidPavementImpact = {
            abiotic_depletion_fossil: 222403,
            acidification: 3963,
            global_warming: 31152,
          };

          // ToDO: Check with Yasj, sheet got multiple values
          let flexiblePavementImpact = {
            abiotic_depletion_fossil: 602243,
            acidification: 4004,
            global_warming: 23382,
          };

          let roadInfraMapping = {
            pipeCulvert: "pipe_culvert",
            flyover: "flyover",
            overheadSignage: "overhead_signage",
            slabCulvert: "slab_culvert",
            footpath: "footpath",
            undefined,
          };

          // Construction. Maintenence & End of Life Phases
          let selectedroadInfra =
            roadInfraMapping[inputJson.panelSelectRoadInfrastructures];

          let footpath_impact_abiotic_depletion_fossil =
            y1 * infraImpact["footpath"]["abiotic_depletion_fossil"];
          let footpath_impact_acidification =
            y1 * infraImpact["footpath"]["acidification"];

          let footpath_impact_global_warming =
            y1 * infraImpact["footpath"]["global_warming"];

          let slab_culvert_impact_abiotic_depletion_fossil =
            y2 * y3 * infraImpact["slab_culvert"]["abiotic_depletion_fossil"];
          let slab_culvert_impact_acidification =
            y2 * y3 * infraImpact["slab_culvert"]["acidification"];
          let slab_culvert_impact_global_warming =
            y2 * y3 * infraImpact["slab_culvert"]["global_warming"];

          let pipe_culvert_impact_abiotic_depletion_fossil =
            y4 * y5 * infraImpact["pipe_culvert"]["abiotic_depletion_fossil"];
          let pipe_culvert_impact_acidification =
            y4 * y5 * infraImpact["pipe_culvert"]["acidification"];
          let pipe_culvert_impact_global_warming =
            y4 * y5 * infraImpact["pipe_culvert"]["global_warming"];

          let overhead_signage_impact_abiotic_depletion_fossil =
            y6 * infraImpact["overhead_signage"]["abiotic_depletion_fossil"];
          let overhead_signage_impact_acidification =
            y6 * infraImpact["overhead_signage"]["acidification"];
          let overhead_signage_impact_global_warming =
            y6 * infraImpact["overhead_signage"]["global_warming"];

          let flyover_impact_abiotic_depletion_fossil =
            y7 * y8 * infraImpact["flyover"]["abiotic_depletion_fossil"];
          let flyover_impact_acidification =
            y7 * y8 * infraImpact["flyover"]["acidification"];
          let flyover_impact_global_warming =
            y7 * y8 * infraImpact["flyover"]["global_warming"];

          logVariableDerivations({
            footpath_impact_abiotic_depletion_fossil,
            footpath_impact_acidification,
            footpath_impact_global_warming,
            slab_culvert_impact_abiotic_depletion_fossil,
            slab_culvert_impact_acidification,
            slab_culvert_impact_global_warming,

            pipe_culvert_impact_abiotic_depletion_fossil,
            pipe_culvert_impact_acidification,
            pipe_culvert_impact_global_warming,

            overhead_signage_impact_abiotic_depletion_fossil,
            overhead_signage_impact_acidification,
            overhead_signage_impact_global_warming,

            flyover_impact_abiotic_depletion_fossil,
            flyover_impact_acidification,
            flyover_impact_global_warming,
          });

          irCME_abiotic_depletion_fossil = [
            z * 0.9 * rigidPavementImpact["abiotic_depletion_fossil"] * dT,
            vehicle_impact["bus"]["abiotic_depletion_fossil"] * i,
            vehicle_impact["car"]["abiotic_depletion_fossil"] * j,
            vehicle_impact["taxi"]["abiotic_depletion_fossil"] * k,
            vehicle_impact["auto"]["abiotic_depletion_fossil"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_abiotic_depletion_fossil`)
              : 0,
          ];

          ifCME_abiotic_depletion_fossil = [
            z * 0.9 * flexiblePavementImpact["abiotic_depletion_fossil"] * dT,
            vehicle_impact["bus"]["abiotic_depletion_fossil"] * i,
            vehicle_impact["car"]["abiotic_depletion_fossil"] * j,
            vehicle_impact["taxi"]["abiotic_depletion_fossil"] * k,
            vehicle_impact["auto"]["abiotic_depletion_fossil"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_abiotic_depletion_fossil`)
              : 0, // Road Infrastructure, ToDo: Check here
          ];

          irCME_acidification = [
            z * 0.9 * rigidPavementImpact["acidification"] * dT,
            vehicle_impact["bus"]["acidification"] * i,
            vehicle_impact["car"]["acidification"] * j,
            vehicle_impact["taxi"]["acidification"] * k,
            vehicle_impact["auto"]["acidification"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_acidification`)
              : 0, // Road Infrastructure, ToDo: Check here
          ];

          ifCME_acidification = [
            z * 0.9 * flexiblePavementImpact["acidification"] * dT,
            vehicle_impact["bus"]["acidification"] * i,
            vehicle_impact["car"]["acidification"] * j,
            vehicle_impact["taxi"]["acidification"] * k,
            vehicle_impact["auto"]["acidification"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_acidification`)
              : 0, // Road Infrastructure, ToDo: Check here
          ];

          irCME_global_warming = [
            z * 0.9 * rigidPavementImpact["global_warming"] * dT,
            vehicle_impact["bus"]["global_warming"] * i,
            vehicle_impact["car"]["global_warming"] * j,
            vehicle_impact["taxi"]["global_warming"] * k,
            vehicle_impact["auto"]["global_warming"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_global_warming`)
              : 0, // Road Infrastructure, ToDo: Check here
          ];

          ifCME_global_warming = [
            z * 0.9 * flexiblePavementImpact["global_warming"] * dT,
            vehicle_impact["bus"]["global_warming"] * i,
            vehicle_impact["car"]["global_warming"] * j,
            vehicle_impact["taxi"]["global_warming"] * k,
            vehicle_impact["auto"]["global_warming"] * l,
            selectedroadInfra
              ? eval(`${selectedroadInfra}_impact_global_warming`)
              : 0, // Road Infrastructure, ToDo: Check here
          ];

          logVariableDerivations({
            irCME_abiotic_depletion_fossil,
            ifCME_abiotic_depletion_fossil,
            irCME_acidification,
            ifCME_acidification,
            irCME_global_warming,
            ifCME_global_warming,
          });

          irCME_abiotic_depletion_fossil = sumArrayValues(
            irCME_abiotic_depletion_fossil
          );

          ifCME_abiotic_depletion_fossil = sumArrayValues(
            ifCME_abiotic_depletion_fossil
          );

          irCME_acidification = sumArrayValues(irCME_acidification);

          ifCME_acidification = sumArrayValues(ifCME_acidification);

          irCME_global_warming = sumArrayValues(irCME_global_warming);

          ifCME_global_warming = sumArrayValues(ifCME_global_warming);

          if (roadPavement == "rigid") {
            let data = [
              {
                impactText: `Total Construction Phase Impacts from Rigid Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Abiotic Depletion Fossil`,
                icon: "fa-fire-alt",
                unit: ` ${removeDecimalPrecision(irCME_abiotic_depletion_fossil)} MJ/km/year`,
              },
              {
                impactText: `Total Construction Impacts from Rigid Pavement & Selected  ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Acidification`,
                icon: "fa-cloud",
                unit: `${removeDecimalPrecision(irCME_acidification)} kg SO2 eq./km/year`,
              },
              {
                impactText: `Total Construction Impacts from Rigid Pavement & Selected  ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Global Warming`,
                icon: "fa-globe",
                unit: ` ${removeDecimalPrecision(irCME_global_warming)} kg CO2 eq./km/year`,
              },
            ];
            generateAndDisplayResults(data);
          } else if (roadPavement == "flexible") {
            // // ToDO: Changes for Flexbile Payvement
            // appendDerivationContent(
            //   ` in MJ/km/year`,
            //   "construction-phase-results-div"
            // );
            // appendDerivationContent(
            //   `Total Construction Impacts from Flexible Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Acidification = ${ifCME_acidification} in kg SO2 eq./km/year`,
            //   "construction-phase-results-div"
            // );
            // appendDerivationContent(
            //   `Total Construction Impacts from Flexible Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Global Warming  = ${ifCME_global_warming} in kg CO2 eq./km/year`,
            //   "construction-phase-results-div"
            // );

            let data = [
              {
                impactText: `Total Construction Phase Impacts from Flexible Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Abiotic Depletion Fossil`,
                icon: "fa-fire-alt",
                unit: ` ${removeDecimalPrecision(ifCME_abiotic_depletion_fossil)} MJ/km/year`,
              },
              {
                impactText: `Total Construction Impacts from Flexible Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Acidification`,
                icon: "fa-cloud",
                unit: `${removeDecimalPrecision(ifCME_acidification)} kg SO2 eq./km/year`,
              },
              {
                impactText: `Total Construction Impacts from Flexible Pavement & Selected ${inputJson.panelSelectRoadInfrastructures} Infrastructures on Global Warming`,
                icon: "fa-globe",
                unit: ` ${removeDecimalPrecision(ifCME_global_warming)} kg CO2 eq./km/year`,
              },
            ];

            generateAndDisplayResults(data);
          }
          loadUseCaseForm();
        }

        function calculatePercentageOfNumberForDistance(percentage, number) {
          if (typeof percentage !== "number" || typeof number !== "number") {
            throw new Error(
              "Both percentage and number should be numeric values."
            );
          }

          if (percentage < 0 || percentage > 100) {
            throw new Error("Percentage should be between 0 and 100.");
          }

          return (percentage / 100) * number;
        }

        function calculatePercentageOfNumber(percentage, number) {
          if (typeof percentage !== "number" || typeof number !== "number") {
            throw new Error(
              "Both percentage and number should be numeric values."
            );
          }

          if (percentage < 0 || percentage > 100) {
            throw new Error("Percentage should be between 0 and 100.");
          }

          return Math.ceil((percentage / 100) * number);
        }

        // function calculateVehiclesRequired(passengerCount, busCapacity) {
        //   console.log(passengerCount, busCapacity, "Passenger & Capacity");

        //   // ToDo: busCapacity is coming in decimal
        //   // if (
        //   //   !Number.isInteger(passengerCount) ||
        //   //   !Number.isInteger(busCapacity)
        //   // ) {
        //   //   throw new Error(
        //   //     "Both passenger count and vehicle capacity should be integers."
        //   //   );
        //   // }

        //   if (passengerCount < 0 || busCapacity <= 0) {
        //     throw new Error(
        //       "Passenger count should be a positive integer and vehicle capacity should be a non-zero positive integer."
        //     );
        //   }

        //   return Math.ceil(passengerCount / busCapacity);
        // }

        function calculateVehiclesRequired(
          vehicleName,
          e1,
          e2,
          f1,
          f2,
          g1,
          g2,
          h1,
          h2
        ) {
          const daysInYear = 365;
          const passengersPerBus = 53;
          const passengersPerCar = 2.5;
          const passengersPerTaxi = 2;
          const passengersPerAuto = 1.5;

          // logVariableDerivations({
          //   passengersPerBus,
          //   passengersPerCar,
          //   passengersPerTaxi,
          //   passengersPerAuto,
          // });

          switch (vehicleName) {
            case "buses":
              const busesNeeded =
                e2 / passengersPerBus / (e1 / (10 * 18 * daysInYear));
              console.log(e2, e1);
              return Math.ceil(busesNeeded);
            case "cars":
              const carsNeeded =
                f2 / passengersPerCar / (f1 / (15 * 3 * daysInYear));
              console.log(carsNeeded, "CarsNeeded");
              console.log(passengersPerCar, "passengersPerCar");
              console.log(f2, "f2");
              console.log(f1, "f1");
              console.log(f2 / passengersPerCar, "(f2 / passengersPerCar)");
              console.log(15 * 3 * daysInYear, "(15 * 3 * daysInYear)");
              console.log(
                f1 / (15 * 3 * daysInYear),
                "(f1 / (15 * 3 * daysInYear)"
              );

              return Math.ceil(carsNeeded);
            case "taxis":
              const taxisNeeded =
                g2 / passengersPerTaxi / (g1 / (12 * 6 * daysInYear));
              return Math.ceil(taxisNeeded);
            case "autos":
              const autosNeeded =
                h2 / passengersPerAuto / (h1 / (10 * 7 * daysInYear));
              return Math.ceil(autosNeeded);
            default:
              throw new Error(
                "Invalid vehicle name. Supported vehicles: buses, cars, taxis, autos"
              );
          }
        }

        function logVariableDerivations(
          object,
          contentType = "basic-derivation"
        ) {
          console.log("Breaking in here", object);

          for (var prop in object) {
            if (object.hasOwnProperty(prop)) {
              appendDerivationContent(prop + ": " + object[prop], contentType);
            }
          }
        }

        function appendDerivationContent(
          stringToAppend,
          contentType = "basic-derivation"
        ) {
          document.getElementById("derivation-div").style.display = "block";
          let parentDiv = "";

          if (contentType == "construction-phase-results-div") {
            derivationDiv = document.getElementById(
              "construction-phase-results-div"
            );
          } else {
            derivationDiv = document.getElementById("derivation-div");
          }

          var pElement = document.createElement("p");
          pElement.innerHTML = stringToAppend;
          derivationDiv.appendChild(pElement);
        }

        function clearDerivationContent() {
          let derivationDiv = document.getElementById("derivation-div");
          derivationDiv.innerHTML = "";
        }

        function sumArrayValues(arr) {
          if (arr.length === 0) {
            return 0;
          }

          let result = arr[0];
          for (let i = 1; i < arr.length; i++) {
            result += arr[i];
          }

          return result;
        }

        function generateAndDisplayResults(
          data,
          divID = "construction-phase-results-div"
        ) {
          let container = document.getElementById(divID);

          container.style.display = "block";

          data.forEach((item) => {
            const impactItem = document.createElement("div");
            impactItem.classList.add("impact-item");

            const iconContainer = document.createElement("div");
            iconContainer.classList.add("icon");
            const icon = document.createElement("i");
            icon.classList.add("fas", item.icon);
            iconContainer.appendChild(icon);
            impactItem.appendChild(iconContainer);

            const impactText = document.createElement("div");
            impactText.classList.add("impact-text");
            impactText.textContent = item.impactText;
            impactItem.appendChild(impactText);

            const unit = document.createElement("div");
            unit.classList.add("unit");
            unit.textContent = item.unit;
            impactItem.appendChild(unit);

            container.appendChild(impactItem);
          });
        }

        function computeFuelRequired(vCount, distanceTravelled, constant) {
          // Check if the input values are valid numbers
          if (
            typeof vCount !== "number" ||
            typeof distanceTravelled !== "number" ||
            typeof constant !== "number"
          ) {
            throw new Error("All input parameters must be numbers.");
          }

          // Check if the constant value is non-zero
          if (constant === 0) {
            throw new Error("The constant value cannot be zero.");
          }

          const Cb = (vCount * distanceTravelled) / constant;
          return Cb;
        }

        function calculateCO2Emissions(
          Ncb,
          Ndb,
          Ncc,
          Ndc,
          Npc,
          Nct,
          Ndt,
          Npt,
          Nca,
          Nda,
          Npa
        ) {
          const Tcb = (Ncb * 492.9) / 1000;
          const Tdb = (Ndb * 638.5) / 1000;
          const Tcc = (Ncc * 126.9) / 1000;
          const Tdc = (Ndc * 108) / 1000;
          const Tpc = (Npc * 95.63) / 1000;
          const Tct = (Nct * 126.9) / 1000;
          const Tdt = (Ndt * 108) / 1000;
          const Tpt = (Npt * 95.63) / 1000;
          const Tca = (Nca * 71.5) / 1000;
          const Tda = (Nda * 441.3) / 1000;
          const Tpa = (Npa * 294.8) / 1000;

          logVariableDerivations({
            Tcb,
            Tdb,
            Tcc,
            Tdc,
            Tpc,
            Tct,
            Tdt,
            Tpt,
            Tca,
            Tda,
            Tpa,
          });
          const ITE =
            Tcb + Tdb + Tcc + Tdc + Tpc + Tct + Tdt + Tpt + Tca + Tda + Tpa;

          logVariableDerivations({ ITE });
          return ITE;
        }

        function removeDecimalPrecision(number) {
          return number | 0;
        }

        function generateOverallResults(results_title, impactItems) {
          document.getElementById("overall-results-div").style.display = "flex";

          document.getElementById("overall-results-header").innerHTML =
            results_title;
          const container = document.querySelector(".result-containers .row");

          // Loop through the impact items and generate HTML dynamically
          impactItems.forEach((item) => {
            const colDiv = document.createElement("div");
            colDiv.className = "col-md-4";

            const impactItemDiv = document.createElement("div");
            impactItemDiv.className = "overall-impact-item text-center";

            const iconDiv = document.createElement("div");
            iconDiv.className = "overall-results-icon";
            const iconElement = document.createElement("i");
            iconElement.className = `fas fa-${item.icon}`;
            iconDiv.appendChild(iconElement);

            const descriptionDiv = document.createElement("div");
            descriptionDiv.className = "description";
            const titleElement = document.createElement("h2");
            titleElement.textContent = item.title;
            const descriptionElement = document.createElement("p");
            descriptionElement.className = "highlight";
            descriptionElement.textContent = item.description;
            descriptionDiv.appendChild(titleElement);
            descriptionDiv.appendChild(descriptionElement);

            impactItemDiv.appendChild(iconDiv);
            impactItemDiv.appendChild(descriptionDiv);

            colDiv.appendChild(impactItemDiv);

            container.appendChild(colDiv);
          });
        }

        // UsePhase Methods
      </script>
    </div>
  </body>
</html>
